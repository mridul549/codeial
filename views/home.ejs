<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

    <!-- Font awesome -->
    <script src="https://kit.fontawesome.com/64dfba247b.js" crossorigin="anonymous"></script>

    <!-- External CSS -->
    <link rel="stylesheet" href="css/styles.css">

    <!-- Title -->
    <title>Just messing around</title>
  </head>
  <body>

    <nav class="navbar navbar-expand-lg navbar-light" style="background-color: #B1B2FF;">
      <a class="navbar-brand" href="#">Codeial</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <% if(locals.user) { %> 
            <li class="nav-item">
              <%= user.name %>
            </li>
            <li class="nav-item">
              <a class="navLink" href="http://localhost:3000/users/signout">Sign Out</a>
            </li>
          <% } else { %> 
            <li class="nav-item">
              <a class="navLink" href="http://localhost:3000/users/signin">Sign In</a>
            </li>
            <li class="nav-item">
              <a class="navLink" href="http://localhost:3000/users/signup">Sign Up</a>
            </li>
          <% } %> 
        </ul>
      </div>
    </nav>

    <div id="feed-posts">
      <h4>Posts</h4>
      <form action="/posts/create" method="post">
        <textarea name="content" cols="30" rows="3"></textarea>
        <input type="submit" value="Post">
      </form>
    </div>

    <div>
      <h4>Posts</h4>
      <ul>
        <% for (let i = 0; i < posts.length; i++) { %>
          <li>
            <!-- if the user who is signed in and the user who created the post are the same, -->
            <!-- then only show the delete option on the page  -->
            <% if((locals.user) && (locals.user.id == posts[i].user.id)) {%>
              <small>
                <a href="/posts/destroy/<%= posts[i].id %> ">X</a>
              </small>
            <% } %> 
            
            <!-- show the contents of the post and the author -->
            <%= posts[i].content %> 
            <small class="author">
              by <%= posts[i].user.name %> 
            </small>
          </li>

          <div class="post-comment">
            <!-- if user is signed in then only let him add a post-->
            <% if(locals.user) { %>
              <form action="/comments/create" method="post">
                <input type="text" name="content" placeholder="Add comment...">
                <!-- hidden input being used to fetch the id of the user who is creating the post -->
                <input type="hidden" name="post" value="<%= posts[i]._id %>">
                <input type="submit" value="Add comment">
              </form>
            <% } %> 

            <!-- adding comments to a post -->
            <div class="post-comment-list">
              <ul id="post-comment-<%= posts[i]._id%>">
                <% for (comment of posts[i].comments) { %>
                  <p>
                    <!-- if the user who is signed in and the user who created the comment are the same, -->
                    <!-- then only show the delete option on the page  -->
                    <% if((locals.user) && (locals.user.id == comment.user.id)) { %>
                      <small>
                        <a href="/comment/destroy/<%= comment.id %>">X</a>
                      </small>
                    <% } %> 

                    <%= comment.content %>
                    <small class="author">
                      by <%= comment.user.name %> 
                    </small> 
                  </p>
                <% } %> 
              </ul>
            </div>
          </div>

        <% } %> 
      </ul>
    </div>

  </body>
</html>
